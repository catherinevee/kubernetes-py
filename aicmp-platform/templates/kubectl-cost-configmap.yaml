{{- if .Values.kubectlCost.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "common.fullname" . }}-kubectl-cost-config
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "common.labels" . | nindent 4 }}
    app.kubernetes.io/component: "kubectl-cost"
  annotations:
    {{- include "common.annotations" . | nindent 4 }}
data:
  config.yaml: |
    # Kubectl-cost Configuration
    # Generated by Helm chart: {{ .Chart.Name }}-{{ .Chart.Version }}
    
    # Kubecost API configuration
    kubecostAPI:
      url: {{ .Values.kubectlCost.config.kubecostAPI.url | quote }}
      port: {{ .Values.kubectlCost.config.kubecostAPI.port }}
      timeout: {{ .Values.kubectlCost.config.kubecostAPI.timeout | quote }}
    
    # Cost allocation configuration
    allocation:
      window: {{ .Values.kubectlCost.config.allocation.window | quote }}
      aggregate: {{ .Values.kubectlCost.config.allocation.aggregate | quote }}
      idle: {{ .Values.kubectlCost.config.allocation.idle }}
      shared: {{ .Values.kubectlCost.config.allocation.shared }}
    
    # Cost optimization settings
    optimization:
      enabled: {{ .Values.kubectlCost.optimization.enabled }}
      recommendations: {{ .Values.kubectlCost.optimization.recommendations }}
      alerts: {{ .Values.kubectlCost.optimization.alerts }}
      thresholds:
        cpu: {{ .Values.kubectlCost.optimization.thresholds.cpu }}
        memory: {{ .Values.kubectlCost.optimization.thresholds.memory }}
        cost: {{ .Values.kubectlCost.optimization.thresholds.cost }}
    
    # Cost reporting configuration
    reporting:
      enabled: {{ .Values.kubectlCost.reporting.enabled }}
      schedules:
        daily:
          enabled: {{ .Values.kubectlCost.reporting.schedules.daily.enabled }}
          schedule: {{ .Values.kubectlCost.reporting.schedules.daily.schedule | quote }}
          format: {{ .Values.kubectlCost.reporting.schedules.daily.format | quote }}
          output: {{ .Values.kubectlCost.reporting.schedules.daily.output | quote }}
        weekly:
          enabled: {{ .Values.kubectlCost.reporting.schedules.weekly.enabled }}
          schedule: {{ .Values.kubectlCost.reporting.schedules.weekly.schedule | quote }}
          format: {{ .Values.kubectlCost.reporting.schedules.weekly.format | quote }}
          output: {{ .Values.kubectlCost.reporting.schedules.weekly.output | quote }}
        monthly:
          enabled: {{ .Values.kubectlCost.reporting.schedules.monthly.enabled }}
          schedule: {{ .Values.kubectlCost.reporting.schedules.monthly.schedule | quote }}
          format: {{ .Values.kubectlCost.reporting.schedules.monthly.format | quote }}
          output: {{ .Values.kubectlCost.reporting.schedules.monthly.output | quote }}
      
      # Cost alerts
      alerts:
        enabled: {{ .Values.kubectlCost.reporting.alerts.enabled }}
        thresholds:
          dailySpend: {{ .Values.kubectlCost.reporting.alerts.thresholds.dailySpend }}
          weeklySpend: {{ .Values.kubectlCost.reporting.alerts.thresholds.weeklySpend }}
          monthlySpend: {{ .Values.kubectlCost.reporting.alerts.thresholds.monthlySpend }}
        notifications:
          email:
            enabled: {{ .Values.kubectlCost.reporting.alerts.notifications.email.enabled }}
            recipients: {{ .Values.kubectlCost.reporting.alerts.notifications.email.recipients | toYaml | nindent 12 }}
          slack:
            enabled: {{ .Values.kubectlCost.reporting.alerts.notifications.slack.enabled }}
            webhook: {{ .Values.kubectlCost.reporting.alerts.notifications.slack.webhook | quote }}
          teams:
            enabled: {{ .Values.kubectlCost.reporting.alerts.notifications.teams.enabled }}
            webhook: {{ .Values.kubectlCost.reporting.alerts.notifications.teams.webhook | quote }}
    
    # Cost optimization recommendations
    optimization:
      enabled: {{ .Values.kubectlCost.optimization.enabled }}
      recommendations:
        # Resource optimization
        resources:
          enabled: {{ .Values.kubectlCost.optimization.recommendations.resources.enabled }}
          cpu:
            minUtilization: {{ .Values.kubectlCost.optimization.recommendations.resources.cpu.minUtilization }}
            maxUtilization: {{ .Values.kubectlCost.optimization.recommendations.resources.cpu.maxUtilization }}
          memory:
            minUtilization: {{ .Values.kubectlCost.optimization.recommendations.resources.memory.minUtilization }}
            maxUtilization: {{ .Values.kubectlCost.optimization.recommendations.resources.memory.maxUtilization }}
        
        # Instance optimization
        instances:
          enabled: {{ .Values.kubectlCost.optimization.recommendations.instances.enabled }}
          spotInstances: {{ .Values.kubectlCost.optimization.recommendations.instances.spotInstances }}
          rightSizing: {{ .Values.kubectlCost.optimization.recommendations.instances.rightSizing }}
          reservedInstances: {{ .Values.kubectlCost.optimization.recommendations.instances.reservedInstances }}
        
        # Storage optimization
        storage:
          enabled: {{ .Values.kubectlCost.optimization.recommendations.storage.enabled }}
          volumeOptimization: {{ .Values.kubectlCost.optimization.recommendations.storage.volumeOptimization }}
          backupOptimization: {{ .Values.kubectlCost.optimization.recommendations.storage.backupOptimization }}
{{- end }} 